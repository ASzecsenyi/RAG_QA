<!doctype html>
<html lang="en">
<head>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>

    <title>RAG QA</title>
    <!-- Include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <style>
        .separator {
            position: relative; /* Needed for absolute positioning of pseudo-elements */
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%; /* Full height relative to its columns */
            width: 10px; /* Adjust based on your preference */
            overflow: hidden; /* Ensures pseudo-elements don’t spill out */
        }

        .separator::before,
        .separator::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            background: #dee2e6; /* Use the separator’s background color */
        }

        .separator::before {
            top: 0;
            bottom: 50%; /* Occupy the top half */
            transform: perspective(10px) rotateX(10deg); /* Slight tilt to create top trapezoid half */
            transform-origin: bottom;
        }

        .separator::after {
            top: 50%; /* Occupy the bottom half */
            bottom: 0;
            transform: perspective(10px) rotateX(-10deg); /* Opposite tilt for bottom half */
            transform-origin: top;
        }
        
        .highlighted-component {
            /* give red border */
            border: 2px solid red;
        }

        .button-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 10px 0;
            border-top: 1px solid #dee2e6; /* Adds a subtle border on top for separation */
            text-align: center;
            z-index: 950; /* Ensures it's above most other elements */
        }

        .card-body {
            background-color: #fff; /* Keep the body of the card white for readability */
        }

        .card-wrapper {
            margin-top: 15px;
            position: relative; /* This makes the absolute positioning of the card relative to this wrapper */
            height: auto; /* Initial height of the compact card */
            margin-bottom: 15px; /* Spacing between cards */
        }

        .card.compact .card-body {
            display: none; /* Hide the body initially */
        }

        .card.compact {
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: initial;
            position: relative;
            z-index: 1; /* Ensure it's above base items but below expanded items */
        }

        .card.compact:hover {
            z-index: 1050; /* Bootstrap modal z-index starts at 1050, ensure it's on top */
            position: fixed; /* Ensure it doesn't move other components */
            height: auto; /* Let it expand to natural height */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Optional: Adds a shadow for better focus */
        }

        .card.compact:hover .card-body {
            display: block; /* Show the body on hover */
        }

        .component-title {
            /*padding: 10px; /* Adjust as per your styling needs */
            font-weight: bold;
        }

        @keyframes wobble-animation {
            0% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
            100% { transform: rotate(0deg); }
        }

        .wobble-effect {
            animation: wobble-animation 0.2s ease-in-out;
        }

        .full-span-row {
            display: flex; /* Make this a flex container */
            flex-wrap: nowrap; /* Prevent items from wrapping */
            align-items: center; /* Vertically centers the flex items */
            height: 50vh; /* Adjust based on your design needs */
        }

        #full-span-row .col {
            flex: 1; /* Make each column take up equal space */
            display: flex; /* Make the column itself a flex container */
            flex-direction: column; /* Stack the children vertically */
            justify-content: center; /* Center children vertically in the column */
            overflow: auto; /* Add scrollbars if necessary */
            height: 50vh; /* Adjust based on your design needs */
        }

    </style>
</head>
<body>
<div class="container mt-5">
    {{ initial_data|json_script:"initial-data" }}
    {{ answers|json_script:"answers" }}
    <div class="row">
        <div class="col">
            <h1>RAG QA</h1>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <!-- Display the basic form fields -->
                <div class="mb-3 row-1">
                    {{ form.name }}
                    {% if form.name.errors %}
                        <div class="alert alert-danger">{{ form.name.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="row">
                    {% for class, name in form.cols.items %}
                        <div class="col">
                            <h3>{{ name }}</h3>
                        </div>
                    {% endfor %}
                </div>
                <!-- Container for dynamically added components in columns -->
                <div id="componentsContainer" class="row full-span-row" >
                    {% for class, name in form.cols.items %}
                        <div id="{{ class }}" class="col">

                        </div>
                        {% if not forloop.last %}
                            <div class="separator">x</div>
                        {% else %}
                            <div class="separator">></div>
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="text-center mt-4 button-container">
                    <!-- Buttons to add new component of each type -->
                    <button type="button" onclick="addTextDocumentComponent()" class="btn btn-info">Add Text Document
                    </button>
                    <button type="button" onclick="addNewsQADocumentComponent()" class="btn btn-info">Add NewsQA
                        Document
                    </button>
                    <button type="button" onclick="addChunkerComponent()" class="btn btn-info">Add Chunker</button>
                    <button type="button" onclick="addRankerComponent()" class="btn btn-info">Add Ranker</button>
                    <button type="button" onclick="addQAComponent()" class="btn btn-info">Add QA</button>

                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </form>
        </div>

        <div id="answer" class="col container mt-5 component-highlighter" style="overflow-wrap: break-word; overflow-y: scroll; height: 80vh;">
           
        </div>

    </div>

</div>

<script>
    <!-- initialise with the value of the number input num_text_documents -->
    let TextDocumentIndexCount = 0;
    let NewsQADocumentIndexCount = 0;
    let ChunkerIndexCount = 0;
    let RankerIndexCount = 0;
    let QAIndexCount = 0;

    let defaultValues = {
        Chunker: {
            CharChunker: {
                chunk_length: 200,
                sliding_window_size: 0.1,
                chunker_name: "char_chunker_"
            },
            SentChunker: {
                chunk_length: 5,
                sliding_window_size: 0.3,
                chunker_name: "sent_chunker_"
            }
        },
        Ranker: {
            TfidfRanker: {
                top_k: 4,
                ranker_name: "tfidf_ranker_"
            },
            SentEmbeddingRanker: {
                top_k: 5,
                ranker_name: "sent_embedding_ranker_"
            },
            GuessSimilarityRanker: {
                top_k: 3,
                ranker_name: "guess_similarity_ranker_"
            }
        },
        QA: {
            MistralQA: {
                model_name: "mistral_qa_"
            },
            GptQA: {
                model_name: "gpt_qa_"
            },
            LlamaQA: {
                model_name: "llama_qa_"
            }
        }
    };

    let customValues = {
        Chunker: {},
        Ranker: {},
        QA: {}
    };

    function addTextDocumentComponent(componentData = null) {
        let fileName = componentData ? componentData.fileName : '';
        let file_path = componentData ? componentData.file_path : '';
        let question = componentData ? componentData.question : '';
        let textdoc_name = componentData ? componentData.textdoc_name : `textdoc_${TextDocumentIndexCount}`;

        const html = `
            <div class="card-wrapper ExperimentTextDocument">
                <div class="card mb-3 compact">
                    <div class="card-header component-title">Text ${TextDocumentIndexCount + 1}</div>
                    <div class="card-body">
                        <input type="file" name="ExperimentTextDocument_file_${TextDocumentIndexCount}" class="form-control mb-2" accept=".txt" value="${fileName}">
                        <input type="text" name="ExperimentTextDocument_file_path_${TextDocumentIndexCount}" placeholder="File path" class="form-control mb-2" value="${file_path}">
                        <input type="text" name="ExperimentTextDocument_question_${TextDocumentIndexCount}" placeholder="Question" class="form-control mb-2" value="${question}">
                        <input type="text" name="ExperimentTextDocument_textdoc_name_${TextDocumentIndexCount}" placeholder="Text Document Name" class="form-control mb-2" value="${textdoc_name}">
                        <input type="checkbox" class="${ componentData == null ? 'deletable-component' : ''} form-check-input mb-2" name="delete_ExperimentTextDocument_${TextDocumentIndexCount}" value="delete"> Delete
                    </div>
                </div>
            </div>
        `;
        $('#ExperimentTextDocument').append(html);
        $('input[type="checkbox"].deletable-component').on('click', deleteComponent);
        TextDocumentIndexCount++;
    }

    function addNewsQADocumentComponent(componentData = null) {
        let story_id = componentData ? componentData.story_id : './cnn/stories/bce33bb5b5cff6b93065aa0cf91917c8dd36ac78.story';
        let newsqa_name = componentData ? componentData.newsqa_name : `newsqa_${NewsQADocumentIndexCount}`;

        const html = `
    <div class="card-wrapper ExperimentTextDocument">
        <div class="card mb-3 compact">
            <div class="card-header component-title">NewsQA ${NewsQADocumentIndexCount + 1}</div>
            <div class="card-body">
                <input type="text" name="ExperimentNewsQaDocument_story_id_${NewsQADocumentIndexCount}" placeholder="story_id" class="form-control mb-2" value="${story_id}">
                <input type="text" name="ExperimentNewsQaDocument_newsqa_name_${NewsQADocumentIndexCount}" placeholder="NewsQA Name" class="form-control mb-2" value="${newsqa_name}">
                <input type="checkbox" class="${ componentData == null ? 'deletable-component' : ''} form-check-input mb-2" name="delete_ExperimentTextDocument_${NewsQADocumentIndexCount}" value="delete"> Delete
            </div>
        </div>
    </div>
  `;
        $('#ExperimentTextDocument').append(html);
        $('input[type="checkbox"].deletable-component').on('click', deleteComponent);
        NewsQADocumentIndexCount++;
    }

    function addChunkerComponent(componentData = null) {
        let chunker_type = componentData ? componentData.chunker_type : 'CharChunker';
        let chunk_length = componentData ? componentData.chunk_length : 200;
        let sliding_window_size = componentData ? componentData.sliding_window_size : 0.1;
        let chunker_name = componentData ? componentData.chunker_name : `chunker_${ChunkerIndexCount}`;

        const html = `
    <div class="card-wrapper ExperimentChunker">
        <div class="card mb-3 compact">
            <div class="card-header component-title">${chunker_type} ${ChunkerIndexCount + 1}</div>
            <div class="card-body">
                <select name="ExperimentChunker_chunker_type_${ChunkerIndexCount}" class="form-select mb-2">
                    <option value="CharChunker" ${chunker_type==='CharChunker' ? 'selected=""' : '' }>CharChunker</option>
                    <option value="SentChunker" ${chunker_type==='SentChunker' ? 'selected=""' : '' }>SentChunker</option>
                </select>
                <input type="number" name="ExperimentChunker_chunk_length_${ChunkerIndexCount}" value=${chunk_length} placeholder="Chunk Length" class="form-control mb-2">
                <input type="text" name="ExperimentChunker_sliding_window_size_${ChunkerIndexCount}" value=${sliding_window_size} placeholder="Sliding Window Size" class="form-control mb-2">
                <input type="text" name="ExperimentChunker_chunker_name_${ChunkerIndexCount}" value="${chunker_name}" placeholder="Chunker Name" class="form-control mb-2">
                <input type="checkbox" class="${ componentData == null ? 'deletable-component' : ''} form-check-input mb-2" name="delete_ExperimentChunker_${ChunkerIndexCount}" value="delete"> Delete
            </div>
        </div>
    </div>
  `;
        $('#ExperimentChunker').append(html);
        $('input[type="checkbox"].deletable-component').on('click', deleteComponent);
        ChunkerIndexCount++;
    }

    function addRankerComponent(componentData = null) {
        let ranker_type = componentData ? componentData.ranker_type : 'TfidfRanker';
        let top_k = componentData ? componentData.top_k : 4;
        let ranker_name = componentData ? componentData.ranker_name : `ranker_${RankerIndexCount}`;

        const html = `
    <div class="card-wrapper ExperimentRanker">
        <div class="card mb-3 compact">
            <div class="card-header component-title">${ranker_type} ${RankerIndexCount + 1}</div>
            <div class="card-body">
                <select name="ExperimentRanker_ranker_type_${RankerIndexCount}"  class="form-select mb-2">
                    <option value="TfidfRanker" ${ranker_type==='TfidfRanker' ? 'selected=""' : '' }>TfidfRanker</option>
                    <option value="SentEmbeddingRanker" ${ranker_type==='SentEmbeddingRanker' ? 'selected=""' : '' }>SentEmbeddingRanker</option>
                    <option value="GuessSimilarityRanker" ${ranker_type==='GuessSimilarityRanker' ? 'selected=""' : '' }>GuessSimilarityRanker</option>
                </select>
                <input type="number" name="ExperimentRanker_top_k_${RankerIndexCount}" value=${top_k} placeholder="Top K" class="form-control mb-2">
                <input type="text" name="ExperimentRanker_ranker_name_${RankerIndexCount}" value="${ranker_name}" placeholder="Ranker Name" class="form-control mb-2">
                <input type="checkbox" class="${ componentData == null ? 'deletable-component' : ''} form-check-input mb-2" name="delete_ExperimentRanker_${RankerIndexCount}" value="delete"> Delete
            </div>
        </div>
    </div>
  `;
        $('#ExperimentRanker').append(html);
        $('input[type="checkbox"].deletable-component').on('click', deleteComponent);
        RankerIndexCount++;
    }

    function addQAComponent(componentData = null) {
        let model_type = componentData ? componentData.model_type : 'MistralQA';
        let model_name = componentData ? componentData.model_name : `qa_${QAIndexCount}`;

        const html = `
    <div class="card-wrapper ExperimentQA">
        <div class="card mb-3 compact">
            <div class="card-header component-title">${model_type} ${QAIndexCount + 1}</div>
            <div class="card-body">
                <select name="ExperimentQA_model_type_${QAIndexCount}" class="form-select mb-2">
                    <option value="MistralQA" ${model_type==='MistralQA' ? 'selected=""' : '' }>MistralQA</option>
                    <option value="GptQA" ${model_type==='GptQA' ? 'selected=""' : '' }>GptQA</option>
                    <option value="LlamaQA" ${model_type==='LlamaQA' ? 'selected=""' : '' }>LlamaQA</option>
                </select>
                <input type="text" name="ExperimentQA_model_name_${QAIndexCount}" value="${model_name}" placeholder="Model Name" class="form-control mb-2">
                <input type="checkbox" class="${ componentData == null ? 'deletable-component' : ''} form-check-input mb-2" name="delete_ExperimentQA_${QAIndexCount}" value="delete"> Delete
            </div>
        </div>
    </div>
  `;
        $('#ExperimentQA').append(html);
        $('input[type="checkbox"].deletable-component').on('click', deleteComponent);
        QAIndexCount++;
    }

    function deleteComponent() {
        $(this).closest('.card-wrapper').remove();
    }

    document.addEventListener("DOMContentLoaded", function() {
        const initialData = JSON.parse(document.getElementById('initial-data').textContent)['components'];
        console.log(initialData);
        initialData.forEach(component => {
            switch(component.type) {
                    case 'ExperimentTextDocument':
    
                        addTextDocumentComponent(component.data);
                        break;
    
                    case 'ExperimentNewsQaDocument':
                        console.log('news')
                        console.log(component.data);
                        addNewsQADocumentComponent(component.data);
                        break;
    
                    case 'ExperimentChunker':
                        addChunkerComponent(component.data);
                        break;
    
                    case 'ExperimentRanker':
                        addRankerComponent(component.data);
                        break;
    
                    case 'ExperimentQA':
                        addQAComponent(component.data);
                        break;
                }
        });
        const answers = JSON.parse(document.getElementById('answers').textContent);
        console.log(answers);
        // answers is a dictionary with the keys being the set of component instances (i.e. pipelines) and the values being the list of answers
        // iterate through the dictionary and display the answers
        for (const [key, value] of Object.entries(answers)) {
            let answerDiv = document.getElementById('answer');
            let answer = document.createElement('div');
            // id the answer div with the key
            // key looks like chunker_0<sep>ranker_0<sep>qa_0<sep>newsqa_0
            answer.id = key;
            // add class component-highlighter-element
            answer.className = 'component-highlighter-element';
            value.forEach((val, index) => {
                // val is a dict, we want the keys question, answer, ground_truths, contexts and fmeasure
                
                let html = `
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5>Question ${index + 1}</h5>
                        </div>
                        <div class="card-body">
                            <p><strong>Question:</strong> ${val.question}</p>
                            <p><strong>Answer:</strong> ${val.answer.replace(val.ground_truths, `<strong>${val.ground_truths}</strong>`)}</p>
                            <p><strong>Ground Truths:</strong> <strong>${val.ground_truths}</strong></p>
                            <p><strong>Contexts:</strong> ${val.contexts.map(context => context.replace(val.ground_truths, `<strong>${val.ground_truths}</strong>`)).join('<br>')}</p>
                            <p><strong>Precision:</strong> ${val.precision}</p>
                            <p><strong>Recall:</strong> ${val.recall}</p>
                            <p><strong>F-Measure:</strong> ${val.fmeasure}</p>
                        </div>
                    </div>
                `;
                // if ground_truths is empty (i.e. it is a list of length 1 with an empty string element), 
                // then we don't want to display it or the metrics
                if (val.ground_truths.length === 1 && val.ground_truths[0] === '') {
                    html = `
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5>Question ${index + 1}</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Question:</strong> ${val.question}</p>
                                <p><strong>Answer:</strong> ${val.answer}</p>
                                <p><strong>Contexts:</strong> ${val.contexts.join('<br>')}</p>
                            </div>
                        </div>
                    `;
                }
                answer.innerHTML += html;
            });
            answerDiv.appendChild(answer);
        }
        
    });

    $(document).ready(function () {
        // Store the original width of each .card.compact in a data attribute
        $('.card.compact').each(function() {
            var originalWidth = $(this).width();
            var originalHeight = $(this).height();
            $(this).data('originalWidth', originalWidth);
            $(this).data('originalHeight', originalHeight);
        });
    
        $('.card-wrapper').hover(
            function() {
                // On mouse in, get original width of .card.compact from data attribute
                var originalWidth = $(this).find('.card.compact').data('originalWidth');
                var originalHeight = $(this).find('.card.compact').data('originalHeight');
                // Set the width of .card-wrapper to the original width of .card.compact
                $(this).css('width', originalWidth);
                $(this).css('height', originalHeight);
            },
            function() {
                // On mouse out, reset the width of .card-wrapper
                $(this).css('width', '');
                $(this).css('height', '');
            }
        );
        var answerDiv = document.getElementById('answer');
        var textContent = answerDiv.textContent || answerDiv.innerText;
        textContent = textContent.trim();

        if (!textContent) {
            /* change answerDiv class to col-1 */
            answerDiv.className = 'col-3';
        }
        // For existing elements, update their classes
        $('input[type="text"], input[type="file"], input[type="number"], select').addClass('form-control mb-2');
        $('input[type="checkbox"]').addClass('form-check-input mb-2');
        $('input[type="select"]').addClass('form-select mb-2');
        $('label').addClass('form-check-label');

        $('#componentsContainer .col').each(function() {
            $(this).sortable({
                items: ".card-wrapper",
                axis: 'y',
                containment: 'parent',
                cursor: 'move',
                opacity: 0.6,
                helper: function(e, ui) {
                    // Create a clone of the element being dragged
                    var clone = ui.clone();
                    clone.css('position', 'absolute');
                    return clone.get(0);
                },
                update: function(event, ui) {
                    console.log("Order updated within the column.");
                }
            }).disableSelection();
        });
        
        const names = ['chunker_name', 'ranker_name', 'model_name', 'textdoc_name', 'newsqa_name', ];
         
        $(document).on('wheel', '.component-highlighter', function(e) {    
            console.log('scrolling');
            // find the component-highlighter-element that is currently in view
            let componentHighlighter = $(this);
            let componentHighlighterElements = componentHighlighter.find('.component-highlighter-element');
            console.log(componentHighlighterElements);
            let currentElement = componentHighlighterElements.filter(function() {
                let rect = this.getBoundingClientRect();
                return (
                    // true if any part of the element is in the viewport - the element is a lot taller than the viewport
                    rect.top <= window.innerHeight && rect.bottom >= 0
                    
                    
                );
            });
            console.log(currentElement.length);
            // if the currentElement is not empty, then we have an element in view
            if (currentElement.length) {
                // get the id of the currentElement
                let currentElementId = currentElement[0].id;
                // get the components whose names are in the currentElementId
                let components = currentElementId.split('<sep>');
                console.log(components);
                // iterate through the components and highlight them - find the component whose name is in the components list and add the class highlighted-component
                components.forEach((component) => {
                    // find the component whose name is in the components list
                    // iterate through the names list and look at all the text inputs whose name contains the component name
                    // if the value of the text input is the same as the component name, then add the class highlighted-component
                    names.forEach((name) => {
                        let componentWrapper = $(`input[name*="${name}"]`).filter(function() {
                            return this.value === component;
                        }).closest('.card');
                        componentWrapper.addClass('highlighted-component');
                        // remove the class highlighted-component from all the other components in the same column
                        componentWrapper.closest('.col').find('.card').not(componentWrapper).removeClass('highlighted-component');
                    });
                });
            }
        });

        $(document).on('wheel', '.card', function(e) {
              // Find the select element within the card
              let select = $(this).find('.form-select');

              // If there's no select element, don't do anything
              if (select.length === 0) {
                return;
              }

              let selectedIndex = select.prop('selectedIndex');
              let scrollDirection = e.originalEvent.deltaY;

              if (scrollDirection < 0) {
                  // Scroll up
                  if (selectedIndex > 0) {
                      select.prop('selectedIndex', selectedIndex - 1).change();
                  }
              } else {
                  // Scroll down
                  if (selectedIndex < select.children('option').length - 1) {
                      select.prop('selectedIndex', selectedIndex + 1).change();
                  }
              }

              // if reached the end of the options, jump back to the first option
              if (selectedIndex === select.children('option').length - 1 && scrollDirection > 0) {
                  select.prop('selectedIndex', 0).change();
              }

              // if reached the start of the options, jump back to the last option
              if (selectedIndex === 0 && scrollDirection < 0) {
                  select.prop('selectedIndex', select.children('option').length - 1).change();
              }

              // change the card name to the selected option + current index
                let cardHeader = $(this).find('.card-header');
                let selectedValue = select.val();
                cardHeader.text(`${selectedValue} ${cardHeader.text().split(' ')[1]}`);


              // Prevent page from scrolling if there's a select element to scroll through
              // Comment this out if you want the whole page to scroll normally
              //e.preventDefault();
          });

        $(document).on('change', '.form-select', function() {
            let select = $(this);
            let selectedValue = select.val();
            let index = select.attr('name').match(/\d+$/)[0];

            const componentMapping = {
                Chunker: {
                    match: select.attr('name').match(/Chunker_(.+)_\d+/),
                    fields: ['chunk_length', 'sliding_window_size', 'chunker_name'],
                    prefix: 'ExperimentChunker',
                },
                Ranker: {
                    match: select.attr('name').match(/Ranker_(.+)_\d+/),
                    fields: ['top_k', 'ranker_name'],
                    prefix: 'ExperimentRanker',
                },
                QA: {
                    match: select.attr('name').match(/QA_(.+)_\d+/),
                    fields: ['model_name'],
                    prefix: 'ExperimentQA',
                },
            };

            Object.keys(componentMapping).forEach((compType) => {
                let comp = componentMapping[compType];
                if (comp.match && comp.match[1] === compType.toLowerCase() + '_type') {
                    if (!customValues[compType][index]) {
                        customValues[compType][index] = {};
                    }

                    updateInputValues(comp, compType, selectedValue, index);
                }
            });

            let parentCard = $(this).closest('.card');

            // Add the 'wobble-effect' class to trigger the animation
            parentCard.addClass('wobble-effect');

            // Listen for the end of the animation and then remove the class
            parentCard.on('animationend', function() {
                parentCard.removeClass('wobble-effect');
            });
        });

        $(document).on('input', 'input', function() {
            let input = $(this);
            let inputName = input.attr('name');
            let index = inputName.match(/\d+$/)[0];

            const componentDetails = [
                { type: 'Chunker', regex: /(ExperimentChunker)_(.+)_\d+$/ },
                { type: 'Ranker', regex: /(ExperimentRanker)_(.+)_\d+$/ },
                { type: 'QA', regex: /(ExperimentQA)_(.+)_\d+$/ },
            ];

            componentDetails.forEach((compDetail) => {
                let match = inputName.match(compDetail.regex);
                if (match) {
                    let fieldType = match[2];
                    let compType = match[1].split('Experiment')[1];
                    let selector = $(`select[name="${compDetail.type}_${compType.toLowerCase()}_type_${index}"]`).val();

                    if (!customValues[compDetail.type][index]) {
                        customValues[compDetail.type][index] = {};
                    }

                    if (!customValues[compDetail.type][index][selector]) {
                        customValues[compDetail.type][index][selector] = {};
                    }

                    customValues[compDetail.type][index][selector][fieldType] = input.val();
                    console.log(customValues);
                }
            });
        });

        function updateInputValues(comp, compType, selectedValue, index) {
            comp.fields.forEach(field => {
                let inputName = `${comp.prefix}_${field}_${index}`;
                let input = $(`input[name="${inputName}"]`);
                let newValue = defaultValues[compType][selectedValue][field];

                if (field.includes('_name')) {
                    newValue += index;
                }

                if (!customValues[compType][index][selectedValue] || !customValues[compType][index][selectedValue][field]) {
                    input.val(newValue);
                } else {
                    input.val(customValues[compType][index][selectedValue][field]);
                }
            });
        }
    });
</script>

</body>
</html>